<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main.css">
    <title>Data Display</title>
    <style>
    </style>

</head>

<body>
    <div class="container">
        <div class="element-grid">
            <div class="news-grid">
                <div class="aktivitets-grid">
                    <div class="element" id="weather-data">
                        <div>
                            <h2>TECHCOLLEGE</h2>
                        </div>
                        <section>
                            <!-- grid here -->
                            <article>
                                <h4>ST. BEDEDAG PÅ TECHCOLLEGE FRA 2024</h4>
                                <h5>Af Ledelsessekretariatet d. 15-3-2023</h5>
                                <p>Som I ved vedtog Folketinget 28. februar 2023 L 13 om konsekvenser ved afskaffelsen
                                    af
                                    store
                                    bededag som helligdag. Med lovforslaget bliver store bededag til en almindelig
                                    ekstra
                                    arbejdsdag fra og med 2024.
                                    https://www.regeringen.dk/nyheder/2023/lovforslag-om-afskaffelse-store-bededag-er-vedtaget-i-folketinget/
                                </p>
                                <p>Dette betyder, at her på TECHCOLLEGE bliver St. Bededag fra 2024 en normal
                                    undervisningsdag
                                    for alle vores elever og en almindelig ekstra arbejdsdag for alle medarbejdere.</p>
                            </article>
                            <article>
                                <h4>KOM TIL TEMADAG OM GRØN OMSTILLING D. 30. MARTS</h4>
                                <h5>Af Kim Mikael Jensen d. 13-3-2023</h5>
                                <p>Er du nysgerrig på grøn omstilling inden for dit fagområde, så kom til temadag på
                                    TECHCOLLEGE d. 30. marts.
                                </p>
                                <p>Du kan blandt andet møde Aalborg Portland, Brøndums Autoservice, Frandsen &
                                    Søndergaard, Lundsby Renewable Solutions.
                                </p>
                            </article>
                        </section>
                    </div>
                    <div class="weather-kantine-grid">
                        <div class="element" id="bus-data">
                            <div>
                                <h2>BUSAFGANG</h2>
                            </div>
                        </div>
                        <div class="element" id="kantine-data">
                            <div>
                                <h2>KANTINE</h2>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="element" id="aktivitets-data">
                    <div>
                        <h2>SKEMA</h2>
                    </div>
                </div>

            </div>
            <div class="element" id="news-data">
            </div>
        </div>
    </div>

    <script>
        const urls = {
            news: "https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.dr.dk%2Fnyheder%2Fservice%2Ffeeds%2Fallenyheder%23",
            busTimes: "https://xmlopen.rejseplanen.dk/bin/rest.exe/multiDepartureBoard?id1=851400602&id2=851973402&rttime&format=json&useBus=1",
            weather: "https://api.openweathermap.org/data/2.5/weather?q=Aalborg&appid=4d58d6f0a435bf7c5a52e2030f17682d&units=metric",
            kantine: "https://infoskaerm.techcollege.dk/umbraco/api/content/getcanteenmenu/?type=json",
            aktivitets: "https://iws.itcn.dk/techcollege/schedules?departmentcode=smed",
        };

        async function FetchAPI(url, json = true) {
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(
                    `There was an error: ${response.status} - ${response.statusText}`
                );
            }

            let data;

            if (json) {
                data = await response.json();
            } else {
                data = await response.text();
            }

            return data;
        }

        Promise.all([
            FetchAPI(urls.news),
            FetchAPI(urls.busTimes),
            FetchAPI(urls.weather),
            FetchAPI(urls.kantine),
            FetchAPI(urls.aktivitets),
        ]).then(([news, busTimes, weather, kantine, aktivitets]) => {
            console.log(busTimes);
            displayData(news.items.map(val => val.title).join(" "), 'news-data');
            displayData(busTimes.MultiDepartureBoard.Departure.map(val => `${val.line} ${val.stop} ${val.time}`).join("<hr class='bus-divider'>"), 'bus-data', 'bus-time');
            displayData(`${weather.name} ${weather.main.temp}°C`, 'weather-data', 'weather');

            const currentWeekDay = new Date().toLocaleDateString('da-DK', { weekday: 'long' });
            const currentDate = new Date().toLocaleDateString('da-DK', { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit' });

            kantine.Days.forEach(day => {
                const dayName = day.DayName.toLowerCase();
                const dish = day.Dish;

                let displayText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)} - ${dish}`;
                if (dayName === currentWeekDay.toLowerCase()) {
                    displayText += " (Today)";
                }

                displayData(displayText, 'kantine-data', 'kantine');
                // Add a divider after each day
                displayData('<hr class="kantine-divider">', 'kantine-data');
            });

            const formatDateToDaninsh = (date) => {
                return new Date(date).toLocaleDateString('da-DK', { weekday: 'long' });
            }

            // Filter aktivitets based on current date
            const currentDateFormatted = new Date().toISOString().split('T')[0];
            const filteredAktivitets = aktivitets.value.filter(val => val.StartDate.split('T')[0] === currentDateFormatted);
            displayData(filteredAktivitets.map(val => ` ${val.Room} - ${val.Education} -${formatDateToDaninsh(val.StartDate)} - ${val.Subject}`).join("<span>"), 'aktivitets-data', 'aktivitets');

        }).catch(error => console.error('Error fetching data:', error));

        function displayData(data, elementId, className = "") {
            const element = document.getElementById(elementId);

            if (data) {
                const p = document.createElement('p');
                p.innerHTML = data;
                if (className !== "") {
                    p.classList.add(className);
                }
                element.appendChild(p);
            }
        }
    </script>
</body>

</html>