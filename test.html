<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Display</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red: #e03235;
            --blue: #0196d2;
            --green: #008516;
            --yellow: #d98825;
            --mid-dark: #3e3d41;
            --idk-what-to-call-this-one: #ded3b6;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: var(--mid-dark);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .element-grid {
            /* display: grid; */
            /* grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        grid-gap: 20px; */
        }

        .news-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
        }


        .element {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 1rem;
        }

        .element h2 {
            margin-top: 0;
            font-size: 1.5rem;
            color: var(--blue);
        }

        .element p {
            margin: 0;
            color: var(--mid-dark);
        }

        .element p.error {
            color: var(--red);
        }

        .element p.bus-time {
            color: var(--green);
        }

        .element p.weather {
            color: var(--yellow);
        }

        .element p.kantine {
            color: var(--red);
            font-weight: bold;
        }

        .element p.aktivitets {
            color: var(--blue);
            font-style: italic;
        }

        /* Scrollable news section */
        #news-data {
            white-space: nowrap;
            overflow-x: auto;
        }

        /* Add a styling rule for the divider */
        .kantine-divider {
            border-top: 1px solid var(--mid-dark);
            margin-top: 10px;
            margin-bottom: 10px;
        }
    </style>

</head>

<body>
    <div class="container">
        <div class="element-grid">
            <div class="news-grid">
                <div class="element" id="bus-data">
                    <h2>Bus Times</h2>
                </div>
                <div class="element" id="weather-data">
                    <h2>Weather</h2>
                </div>
                <div class="element" id="kantine-data">
                    <h2>Kantine</h2>
                </div>
                <div class="element" id="aktivitets-data">
                    <h2>Activities</h2>
                </div>
            </div>
            <div class="element" id="news-data">
                <h2>News</h2>
            </div>
        </div>
    </div>

    <script>
        const urls = {
            news: "https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.dr.dk%2Fnyheder%2Fservice%2Ffeeds%2Fallenyheder%23",
            busTimes: "https://xmlopen.rejseplanen.dk/bin/rest.exe/multiDepartureBoard?id1=851400602&id2=851973402&rttime&format=json&useBus=1",
            weather: "https://api.openweathermap.org/data/2.5/weather?q=Aalborg&appid=4d58d6f0a435bf7c5a52e2030f17682d&units=metric",
            kantine: "https://infoskaerm.techcollege.dk/umbraco/api/content/getcanteenmenu/?type=json",
            aktivitets: "https://iws.itcn.dk/techcollege/schedules?departmentcode=smed",
        };

        async function FetchAPI(url, json = true) {
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(
                    `There was an error: ${response.status} - ${response.statusText}`
                );
            }

            let data;

            if (json) {
                data = await response.json();
            } else {
                data = await response.text();
            }

            return data;
        }

        Promise.all([
            FetchAPI(urls.news),
            FetchAPI(urls.busTimes),
            FetchAPI(urls.weather),
            FetchAPI(urls.kantine),
            FetchAPI(urls.aktivitets),
        ]).then(([news, busTimes, weather, kantine, aktivitets]) => {
            console.log(kantine);
            displayData(news.items.map(val => val.title).join(" "), 'news-data');
            displayData(busTimes.MultiDepartureBoard.Departure.map(val => `${val.name} ${val.direction} ${val.time}`).join(" "), 'bus-data', 'bus-time');
            displayData(`${weather.name} ${weather.main.temp}Â°C`, 'weather-data', 'weather');

            const currentWeekDay = new Date().toLocaleDateString('da-DK', { weekday: 'long' });
            const currentDate = new Date().toLocaleDateString('da-DK', { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit' });

            kantine.Days.forEach(day => {
                const dayName = day.DayName.toLowerCase();
                const dish = day.Dish;

                let displayText = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)} - ${dish}`;
                if (dayName === currentWeekDay.toLowerCase()) {
                    displayText += " (Today)";
                }

                displayData(displayText, 'kantine-data', 'kantine');
                // Add a divider after each day
                displayData('<hr class="kantine-divider">', 'kantine-data');
            });

            const formatDateToDaninsh = (date) => {
                return new Date(date).toLocaleDateString('da-DK', { weekday: 'long' });
            }

            displayData(aktivitets.value.map(val => `${val.Education} - ${val.Room} - ${formatDateToDaninsh(val.StartDate)} - ${val.Subject}`).join("<br>"), 'aktivitets-data', 'aktivitets');

        }).catch(error => console.error('Error fetching data:', error));

        function displayData(data, elementId, className = "") {
            const element = document.getElementById(elementId);

            if (data) {
                const p = document.createElement('p');
                p.innerHTML = data;
                if (className !== "") {
                    p.classList.add(className);
                }
                element.appendChild(p);
            }
        }
    </script>
</body>

</html>